{"version":3,"sources":["../src/collapsibletopics.js"],"names":["define","$","log","str","setState","course","toggles","storage","window","localStorage","setItem","JSON","stringify","sessionStorage","getState","getItem","parse","init","args","debug","document","ready","sectiontoggles","keepstateoversession","setTimeout","each","index","section","parent","hasClass","collapse","on","event","preventDefault","target","removeClass","addClass","html","M","util","get_string","hasOwnProperty","href","attr","lastIndexOf","substring","sectionstringid","sectionid","state","children","val","closest","progressbar","find","oldvalue","parseInt","newvalue","total","percent","Math","round","get_strings","key","component","param","complete","then","progress"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Actions\" panel at the bottom of the page.\n *\n * @package    format_collapsibletopics\n * @author     Jean-Roch Meurisse\n * @copyright  2018 University of Namur - Cellule TICE\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/str'], function($, log, str) {\n\n    \"use strict\";\n\n    /**\n     * Update toggles state of current course in browser storage.\n     */\n    var setState = function(course, toggles, storage) {\n        if (storage == 'local') {\n            window.localStorage.setItem('sections-toggle-' + course, JSON.stringify(toggles));\n        } else if (storage == 'session') {\n            window.sessionStorage.setItem('sections-toggle-' + course, JSON.stringify(toggles));\n        }\n    };\n\n    /**\n     * Update toggles state of current course in browser storage.\n     */\n    var getState = function(course, storage) {\n        var toggles;\n        if (storage == 'local') {\n            toggles = window.localStorage.getItem('sections-toggle-' + course);\n        } else if (storage == 'session') {\n            toggles = window.sessionStorage.getItem('sections-toggle-' + course);\n        }\n        if (toggles === null) {\n            return {};\n        } else {\n            return JSON.parse(toggles);\n        }\n    };\n\n    return {\n        init: function(args) {\n            log.debug('Format collapsibletopics AMD module initialized');\n            $(document).ready(function($) {\n                var sectiontoggles;\n                var keepstateoversession = args.keepstateoversession;\n                var storage;\n                if (keepstateoversession == 1) {\n                    // Use browser local storage.\n                    storage = 'local';\n                } else {\n                    // Use browser session storage.\n                    storage = 'session';\n                }\n\n                sectiontoggles = getState(args.course, storage);\n\n                setTimeout(function() {\n\n                    $('.sectiontoggle').each(function (index) {\n                        var section = '#collapse-' + (index + 1);\n                        if ($(section).parent().parent().hasClass('current') || (index + 1) in sectiontoggles) {\n                            $(section).collapse('show');\n                        } else {\n                            $(section).collapse('hide');\n                        }\n                    });\n                }, 50);\n\n                // Handle toggle all sections.\n                $('body').on('click', '.expandall', function(event) {\n                    event.preventDefault();\n                    var target = event.target;\n                    $(target).removeClass('expandall').addClass('collapseall').html(M.util.get_string('collapseall', 'moodle'));\n\n                    $('.sectiontoggle').each(function(index) {\n                        var section = '#collapse-' + (index + 1);\n                        $(section).collapse('show');\n                        if (!sectiontoggles.hasOwnProperty(index + 1)) {\n                            sectiontoggles[index + 1] = \"true\";\n                            setState(args.course, sectiontoggles, storage);\n                        }\n                    });\n                });\n\n                $('body').on('click', '.collapseall', function(event) {\n                    event.preventDefault();\n                    var target = event.target;\n                    $(target).removeClass('collapseall').addClass('expandall').html(M.util.get_string('expandall', 'moodle'));\n                    $('.sectiontoggle').each(function(index) {\n                        var section = '#collapse-' + (index + 1);\n                        $(section).collapse('hide');\n                        if (sectiontoggles.hasOwnProperty(index + 1)) {\n                            delete sectiontoggles[index + 1];\n                            setState(args.course, sectiontoggles, storage);\n                        }\n                    });\n                });\n                $('#nav-drawer div.media').on('click', function(event) {\n\n                    var href = $(event.target).parent().parent().parent().attr('href');\n\n                    if (href.lastIndexOf('#section-') != -1) {\n                        var index = href.substring(href.lastIndexOf('-') + 1);\n                        var attr = '#collapse-' + index;\n                        $(attr).collapse('show');\n                    }\n                });\n\n                $('.collapse').on('show.bs.collapse', function(event) {\n                    var sectionstringid = $(event.target).attr('id');\n                    var sectionid = sectionstringid.substring(sectionstringid.lastIndexOf('-') + 1);\n\n                    if (!sectiontoggles.hasOwnProperty(sectionid)) {\n                        sectiontoggles[sectionid] = \"true\";\n                        setState(args.course, sectiontoggles, storage);\n                    }\n                });\n\n                $('.collapse').on('hide.bs.collapse', function(event) {\n                    var sectionstringid = $(event.target).attr('id');\n                    var sectionid = sectionstringid.substring(sectionstringid.lastIndexOf('-') + 1);\n\n                    if (sectiontoggles.hasOwnProperty(sectionid)) {\n                        delete sectiontoggles[sectionid];\n                        setState(args.course, sectiontoggles, storage);\n                    }\n                });\n                $('body').on('click', '.togglecompletion button', function(event) {\n                    var target = event.target;\n                    var state  = $(target).parent().parent().children('input[name=\"completionstate\"]').val();\n                    var section = ($(target).closest('li.section'));\n                    var progressbar = $(section).find('.progress-bar');\n                    var oldvalue = parseInt($(progressbar).attr('aria-valuenow'));\n                    var newvalue = state == 1 ? oldvalue + 1 : oldvalue - 1;\n                    var total = parseInt($(progressbar).attr('aria-valuemax'));\n                    var percent = Math.round((newvalue / total * 100));\n                    $(progressbar).attr('aria-valuenow', newvalue);\n                    $(progressbar).attr('style', 'width: ' + percent + '%');\n                    var strings = [\n                        {\n                            key: 'progresstotal',\n                            component: 'completion',\n                            param : {\n                                complete: newvalue,\n                                total: total\n                            }\n                        }\n                    ];\n                    str.get_strings(strings).then(function(progress) {\n                        $(progressbar).attr('data-original-title', progress);\n                    });\n\n                });\n            });\n        }\n    };\n});\n"],"file":"collapsibletopics.min.js"}